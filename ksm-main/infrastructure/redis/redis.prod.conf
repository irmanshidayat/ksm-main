# KSM Main Redis Production Configuration
# Optimized untuk production dengan security, performance, dan monitoring

# =============================================================================
# NETWORK CONFIGURATION
# =============================================================================

# Bind ke semua interface untuk production
bind 0.0.0.0

# Port Redis
port 6379

# Timeout untuk client connections
timeout 300

# TCP keepalive
tcp-keepalive 60

# =============================================================================
# GENERAL CONFIGURATION
# =============================================================================

# Daemonize (tidak digunakan dalam Docker)
daemonize no

# PID file
pidfile /var/run/redis.pid

# Log level untuk production
loglevel notice

# Log file
logfile /var/log/redis/redis.log

# Database number
databases 16

# =============================================================================
# MEMORY CONFIGURATION
# =============================================================================

# Max memory untuk production (2GB)
maxmemory 2gb

# Memory policy
maxmemory-policy allkeys-lru

# =============================================================================
# PERSISTENCE CONFIGURATION
# =============================================================================

# Save snapshots
save 900 1
save 300 10
save 60 10000

# RDB compression
rdbcompression yes

# RDB checksum
rdbchecksum yes

# RDB filename
dbfilename dump.rdb

# RDB directory
dir /data

# AOF (Append Only File) untuk production
appendonly yes
appendfilename "appendonly.aof"

# AOF sync policy
appendfsync everysec

# AOF rewrite
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# =============================================================================
# REPLICATION CONFIGURATION
# =============================================================================

# Master password (tidak digunakan untuk production)
# masterauth

# Slave password (tidak digunakan untuk production)
# requirepass

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# Enable protected mode untuk production
protected-mode yes

# Require password untuk production
# Untuk Development: Comment baris ini (tidak menggunakan password)
# Untuk Production: Uncomment dan ganti dengan password yang aman
# requirepass your_redis_password

# Disable dangerous commands untuk production
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG ""

# =============================================================================
# CLIENT CONFIGURATION
# =============================================================================

# Max clients
maxclients 1000

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================

# Slow log
slowlog-log-slower-than 10000
slowlog-max-len 128

# Latency monitoring
latency-monitor-threshold 100

# =============================================================================
# ADVANCED CONFIGURATION
# =============================================================================

# Hash configuration
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List configuration
list-max-ziplist-size -2
list-compress-depth 0

# Set configuration
set-max-intset-entries 512

# Sorted set configuration
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog configuration
hll-sparse-max-bytes 3000

# Streams configuration
stream-node-max-bytes 4096
stream-node-max-entries 100

# =============================================================================
# PRODUCTION SPECIFIC CONFIGURATION
# =============================================================================

# Enable keyspace notifications untuk production
notify-keyspace-events "Ex"

# Enable command logging untuk production
# log-commands

# Enable client connections logging
# log-clients

# =============================================================================
# PERFORMANCE CONFIGURATION
# =============================================================================

# TCP backlog
tcp-backlog 511

# Unix socket (tidak digunakan untuk production)
# unixsocket /tmp/redis.sock
# unixsocketperm 700

# =============================================================================
# DEBUGGING CONFIGURATION
# =============================================================================

# Disable debug mode untuk production
# debug-mode no

# Disable verbose logging untuk production
# verbose-logging no

# =============================================================================
# PRODUCTION TOOLS CONFIGURATION
# =============================================================================

# Enable Redis Commander compatibility
# redis-commander compatible

# Enable RedisInsight compatibility
# redisinsight compatible

# =============================================================================
# CUSTOM CONFIGURATION
# =============================================================================

# Custom configuration untuk production
# production-mode yes
# hot-reload no
# debug-commands no

# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================

# Enable automatic backup
# backup-enabled yes
# backup-schedule "0 2 * * *"
# backup-retention-days 30

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================

# Enable monitoring
# monitoring-enabled yes
# monitoring-interval 60
# monitoring-threshold 1000

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# Enable security features
# security-enabled yes
# security-log-file /var/log/redis/security.log
# security-max-failed-attempts 5
# security-lockout-duration 300

# =============================================================================
# PERFORMANCE CONFIGURATION
# =============================================================================

# Enable performance monitoring
# performance-monitoring yes
# performance-log-file /var/log/redis/performance.log
# performance-threshold 100

# =============================================================================
# CUSTOM CONFIGURATION
# =============================================================================

# Custom configuration untuk production
# production-mode yes
# hot-reload no
# debug-commands no
